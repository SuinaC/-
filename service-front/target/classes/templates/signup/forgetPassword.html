<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>忘记密码</title>
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" th:href="@{/signup/css/modalbox.css}"/>
    <link href="http://cdn.bootstrapmb.com/fontawesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
<!-- 2. 模态框容器的根节点，它通常会显示为一个透明的遮罩覆盖全屏 -->
<div id="forget-password">
    <!-- 3. 模态框内容的跟节点，它通常是一个非透明的容器，用于展示具体内容 -->
    <div class="modalbox-dialog signin-form">
        <h3>重置密码</h3>
        <input type="text" placeholder="请输入手机号" name="phone" id="phone" required="">
        <div>
            <input type="text" id="verifyCode" placeholder="请输入验证码" name="verifyCode" style="width: 40%;float: left">
            <button onclick="sendVerifyCode()" class="sendVerifyCode"
                    style="display:inline-block;float: right;width: 50%;">获取短信验证码
            </button>
        </div>
        <input type="submit" onclick="forgetPwd()" value="提交重置">
        <div class="signin-agileits-bottom">
            <p><a href="/consumer/login"><i class="fa fa-arrow-left" aria-hidden="true"></i> 关闭页面进入登录页</a></p>
        </div>
    </div>
</div>
</body>
<script src="/static/signup/js/jquery.min.js" th:src="@{/signup/js/jquery.min.js}"></script>
<script src="/static/signup/js/jquery.min.js" th:src="@{/signup/js/index.js}"></script>
<script src="/static/signup/js/jquery.js" th:src="@{/signup/js/jquery.js}"></script>
<script src="/static/signup/js/message.js" th:src="@{/signup/js/message.js}"></script>
<script type="text/javascript" src="/static/signup/js/multiselect.js" th:src="@{/signup/js/multiselect.js}"></script>
<script src="https://cdn.bootcss.com/js-sha1/0.6.0/sha1.js"></script>
<script>
    //短信验证码倒计时
    var countdownHandler = function () {
        var $button = $(".sendVerifyCode");
        var number = 60;
        var countdown = function () {
            if (number == 0) {
                $button.attr("disabled", false);
                $button.html("发送验证码");
                number = 60;
                return;
            } else {
                $button.attr("disabled", true);
                $button.html(number + "秒 重新发送");
                number--;
            }
            setTimeout(countdown, 1000);
        }
        setTimeout(countdown, 1000);
    }

    //发送短信验证码
    function sendVerifyCode() {
        var regname = $("#phone").val();
        if (regname == '') {
            alert("请输入手机号")
            return;
        }
        var data = {};
        data.regname = regname;
        $.ajax({
            url: "/consumer/sendSms",
            async: true,
            type: "post",
            dataType: "text",
            data: data,
            success: function (data) {
                countdownHandler();
                if (data != 'success') {
                    alert('验证码发送失败，请重新发送！')
                    return;
                }
            }
        });
    }
</script>
<script>
    function forgetPwd() {
        var phone = $("#phone").val();
        var verifyCode = $("#verifyCode").val();
        if (phone == '') {
            alert("请输入手机号");
            return;
        }
        if (verifyCode == '') {
            alert("请输入验证码");
            return;
        }
        $.post(
            "/consumer/forgetPwd",
            "verifyCode=" + verifyCode,
            function (data) {
                if (data == "success") {
                    url = "/consumer/resetPwd" + "?phone=" + phone;
                    location.href = url
                } else if (data == "error") {
                    // $("#span1").html('<font color=\'red\'>验证码错误</font>');
                    // alert("用户名或密码错误").then(callback)
                    confirm({title: '提示', content: '验证码错误', doneText: '确认', cancalText: '取消'});
                }
            })

    }
</script>
<script>
    window.onbeforeunload = function (e) {
        var e = window.event || e;
        // e.returnValue=("确定离开当前页面吗？");
        $("#phone").val("");
        $("#verifyCode").val("");
    }
</script>
</html>